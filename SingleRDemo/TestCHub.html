<!DOCTYPE html>
<html>
<head>
    <title>SignalR Simple Chat</title>
    <style type="text/css">
        .container {
            background-color: #99CCFF;
            border: thick solid #808080;
            padding: 20px;
            margin: 20px;
        }

        .playTable td {
            width: 4px;
            height: 4px;
            border: 1px solid black;
        }

        .playTable {
            border-collapse: collapse;
        }
    </style>

    <!--Script references. -->
    <!--Reference the jQuery library. -->
    <script src="Scripts/jquery-1.6.4.min.js"></script>
    <!--Reference the SignalR library. -->
    <script src="Scripts/jquery.signalR-1.1.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="signalr/hubs"></script>
    <!--Add script to update the page and send messages.-->
</head>
<body>
    <div class="container">
        <!--
        <input type="text" id="message" />  
  
        <input type="button" id="showgameboard" value="Show Gameboard" />
        <input type="button" id="initiateboard" value="Initiate Gameboard" />
        <input type="button" id="movesnake" value="Move Snake" />

        <input type="button" id="RunGameCore" value="Start Game" />
        <input type="button" id="StopGameCore" value="Stop Game" />

        <input type="button" id="gameTableBtn" value="Show Game Table" />
        -->
        <div id="divStartControls">
            <input type="button" id="btnStartApplication" value="Start Application" />
            <input type="text" id="BoardX" value="70" />
            X 
            <input type="text" id="BoardY" value="70" />
        </div>
        <div id="divStopControls" style="display: none">
            <input type="button" id="btnStopApplication" value="Stop Application" />
        </div>
        <input type="hidden" id="displayname" />
        <ul id="discussion">
        </ul>

    </div>

    <div id="messages"></div>
    <table id="playTable" class="playTable" cellspacing="0">
    </table>

    <script type="text/javascript">
        var playTableX = 60;
        var playTableY = 60;
        var playTableIsDrawn = false;

        $(document).ready(function () {
        })


        function DrawPlayTable() {
            $("#playTable").empty();
            for (i = 1; i < playTableX; i++) {
                row = $('<tr></tr>');
                for (j = 1; j < playTableY; j++) {
                    row.append($('<td></td>'));
                }
                $("#playTable").append(row);
            }

        }


        function HideStartControls() {
            $("#divStartControls").hide();
        }

        function ShowStopApplicationControls() {
            $("#divStopControls").show();
        }


        $(function () {
            // Declare a proxy to reference the hub. 
            var chat = $.connection.cHub;

            chat.client.showTableOnJavascript = function (appArray,players) {
                UpdateGameTable(appArray)
                //if the game runs ok 
                HideStartControls();
                ShowStopApplicationControls()
            }

            $('#message').focus();
            // Start the connection.
            $.connection.hub.start().done(function () {

                $('#displayapplicationname').click(function (newapplicationname) {
                    // Call the Send method on the hub. 
                    chat.server.displayApplicationName();
                    // Clear text box and reset focus for next comment. 
                    $('#message').val('').focus();
                });

                $('#appwatchstart').click(function () {
                    // Call the Send method on the hub. 
                    chat.server.runApplicationWatch();
                    // Clear text box and reset focus for next comment. 
                    $('#message').val('').focus();
                });


                $('#appwatchstop').click(function () {
                    // Call the Send method on the hub. 
                    chat.server.stopApplicationWatch();
                    // Clear text box and reset focus for next comment. 
                    $('#message').val('').focus();
                });

                $('#gameTableBtn').click(function () {
                    // Call the Send method on the hub.                     
                    chat.server.showGameBoard();
                    // Clear text box and reset focus for next comment.                   
                });

                $('#showgameboard').click(function () {
                    // Call the Send method on the hub.                     
                    chat.server.showGameBoard();

                    // Clear text box and reset focus for next comment.                   
                });

                $("#initiateboard").click(function () {
                    chat.server.initiateGameBoard(playTableX, playTableY);
                    chat.server.showGameBoard();
                })

                $("#movesnake").click(function () {
                    chat.server.moveSnakes();
                })


                $("#btnStartApplication").click(function () {
                    playTableX = $("#BoardX").val();
                    playTableY = $("#BoardY").val();
                    chat.server.runGameCore(playTableX, playTableY);
                    location.reload();
                });

                $("#btnStopApplication").click(function () {
                    console.log("stoooped");
                    chat.server.stopGameCore();
                    $("#btnStopApplication").hide();
                });
            });
        });


        function UpdateGameTable(table) {
            playtable = document.getElementById("playTable");

            if (!playTableIsDrawn) {
                playTableX = table.length + 1;
                playTableY = table[0].length + 1;
                DrawPlayTable();
                playTableIsDrawn = true;
            }

            for (i = 0; i < table.length; i++) {
                for (j = 0; j < table[i].length; j++) {
                    if (table[i][j] != 0) {
                        $(playtable.rows[i].cells[j]).css("background-color", "red");
                    }
                    else {
                        $(playtable.rows[i].cells[j]).css("background-color", "white");
                    }
                }
            }
            HideStartControls();
            ShowStopApplicationControls();
        }
    </script>
</body>
</html>
